<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Sistema Portu√°rio</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      :root {
        --primary-color: #0077cc;
        --primary-dark: #005fa3;
        --secondary-color: #1a3e5c;
        --light-color: #f0f5f9;
        --success-color: #2ecc71;
        --error-color: #e74c3c;
        --warning-color: #f39c12;
        --gray-color: #6c757d;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--light-color);
        color: #333;
        line-height: 1.6;
      }

      .container {
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: 250px;
        background: linear-gradient(to bottom, var(--secondary-color), #0f2027);
        color: white;
        padding: 20px 0;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
      }

      .sidebar-logo {
        width: 80px;
        height: 80px;
        object-fit: contain;
        margin-bottom: 10px;
      }

      .sidebar-title {
        font-size: 18px;
        font-weight: 600;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .menu-item {
        padding: 12px 20px;
        display: flex;
        align-items: center;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s;
      }

      .menu-item:hover,
      .menu-item.active {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .menu-item i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
      }

      .main-content {
        flex: 1;
        margin-left: 250px;
        padding: 30px;
      }

      .page-header {
        margin-bottom: 30px;
      }

      .page-title {
        font-size: 24px;
        color: var(--secondary-color);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
      }

      .page-title i {
        margin-right: 10px;
        color: var(--primary-color);
      }

      .breadcrumb {
        display: flex;
        list-style: none;
        font-size: 14px;
        color: var(--gray-color);
      }

      .breadcrumb li:not(:last-child)::after {
        content: "/";
        margin: 0 8px;
      }

      .breadcrumb a {
        color: var(--primary-color);
        text-decoration: none;
      }

      .breadcrumb a:hover {
        text-decoration: underline;
      }

      .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 20px;
        display: flex;
        flex-direction: column;
      }

      .stat-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .stat-card-title {
        font-size: 14px;
        color: var(--gray-color);
        font-weight: 500;
      }

      .stat-card-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }

      .icon-primary {
        background-color: var(--primary-color);
      }

      .icon-success {
        background-color: var(--success-color);
      }

      .icon-warning {
        background-color: var(--warning-color);
      }

      .icon-danger {
        background-color: var(--error-color);
      }

      .stat-card-value {
        font-size: 28px;
        font-weight: 600;
        color: var(--secondary-color);
        margin-bottom: 5px;
      }

      .stat-card-desc {
        font-size: 12px;
        color: var(--gray-color);
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        padding: 20px;
        height: 100%;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .card-title {
        font-size: 18px;
        color: var(--secondary-color);
        font-weight: 600;
      }

      .card-actions {
        display: flex;
        gap: 10px;
      }

      .btn-icon {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f0f0f0;
        color: var(--gray-color);
        border: none;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-icon:hover {
        background-color: #e0e0e0;
        color: var(--secondary-color);
      }

      .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
      }

      .table-responsive {
        overflow-x: auto;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
      }

      .data-table th,
      .data-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .data-table th {
        font-weight: 600;
        color: var(--secondary-color);
        background-color: #f8f9fa;
      }

      .data-table tbody tr:hover {
        background-color: #f8f9fa;
      }

      .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }

      .badge-primary {
        background-color: rgba(0, 119, 204, 0.1);
        color: var(--primary-color);
      }

      .badge-success {
        background-color: rgba(46, 204, 113, 0.1);
        color: var(--success-color);
      }

      .badge-warning {
        background-color: rgba(243, 156, 18, 0.1);
        color: var(--warning-color);
      }

      .badge-danger {
        background-color: rgba(231, 76, 60, 0.1);
        color: var(--error-color);
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        display: none;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(0, 119, 204, 0.2);
        border-radius: 50%;
        border-top-color: var(--primary-color);
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .filter-bar {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .filter-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .filter-label {
        font-size: 14px;
        font-weight: 500;
        color: var(--secondary-color);
      }

      .filter-select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        min-width: 150px;
      }

      .filter-select:focus {
        border-color: var(--primary-color);
        outline: none;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .btn i {
        margin-right: 8px;
      }

      .btn-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-dark);
      }

      .btn-outline {
        background-color: transparent;
        border: 1px solid var(--gray-color);
        color: var(--gray-color);
      }

      .btn-outline:hover {
        background-color: #f8f9fa;
      }

      .progress-bar {
        height: 8px;
        background-color: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 5px;
      }

      .progress-fill {
        height: 100%;
        border-radius: 4px;
      }

      .fill-primary {
        background-color: var(--primary-color);
      }

      .fill-success {
        background-color: var(--success-color);
      }

      .fill-warning {
        background-color: var(--warning-color);
      }

      .fill-danger {
        background-color: var(--error-color);
      }

      .ship-card {
        display: flex;
        align-items: center;
        padding: 15px;
        border-radius: 8px;
        background-color: #f8f9fa;
        margin-bottom: 15px;
        transition: all 0.3s;
      }

      .ship-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .ship-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 20px;
      }

      .ship-info {
        flex: 1;
      }

      .ship-name {
        font-weight: 600;
        color: var(--secondary-color);
        margin-bottom: 5px;
      }

      .ship-details {
        font-size: 13px;
        color: var(--gray-color);
      }

      .ship-cargo {
        text-align: right;
      }

      .ship-cargo-count {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 18px;
      }

      .ship-cargo-label {
        font-size: 12px;
        color: var(--gray-color);
      }

      @media (max-width: 1200px) {
        .dashboard-stats {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 992px) {
        .sidebar {
          width: 70px;
          overflow: visible;
        }

        .sidebar-header {
          padding: 10px;
        }

        .sidebar-title,
        .menu-item span {
          display: none;
        }

        .sidebar-logo {
          width: 40px;
          height: 40px;
        }

        .menu-item {
          padding: 15px;
          justify-content: center;
        }

        .menu-item i {
          margin-right: 0;
          font-size: 18px;
        }

        .main-content {
          margin-left: 70px;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .dashboard-stats {
          grid-template-columns: 1fr;
        }

        .filter-bar {
          flex-direction: column;
          align-items: flex-start;
        }

        .filter-group {
          width: 100%;
        }

        .filter-select {
          flex: 1;
        }
      }

      @media (max-width: 576px) {
        .main-content {
          padding: 15px;
        }

        .card {
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner"></div>
    </div>

    <div class="container">
      <div class="sidebar">
        <div class="sidebar-header">
          <img
            src="https://placehold.co/200x200/0077cc/FFFFFF/png?text=PS"
            alt="Logo Porto Santos"
            class="sidebar-logo"
          />
          <div class="sidebar-title">Sistema Portu√°rio</div>
        </div>
        <div class="sidebar-menu">
          <a href="./dashboard.html" class="menu-item active">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
          <a href="./CadastroNavio.html" class="menu-item">
            <i class="fas fa-ship"></i>
            <span>Navios</span>
          </a>
          <a href="./CadastroCarga.html" class="menu-item">
            <i class="fas fa-boxes-stacked"></i>
            <span>Cargas</span>
          </a>
          <a href="index.html" class="menu-item">
            <i class="fas fa-sign-out-alt"></i>
            <span>Sair</span>
          </a>
        </div>
      </div>

      <div class="main-content">
        <div class="page-header">
          <h1 class="page-title">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </h1>
          <ul class="breadcrumb">
            <li><a href="dashboard.html">In√≠cio</a></li>
            <li>Dashboard</li>
          </ul>
        </div>

        <div class="filter-bar">
          <div class="filter-group">
            <span class="filter-label">Per√≠odo:</span>
            <select class="filter-select" id="filterPeriod">
              <option value="today">Hoje</option>
              <option value="week" selected>Esta Semana</option>
              <option value="month">Este M√™s</option>
              <option value="quarter">Este Trimestre</option>
              <option value="year">Este Ano</option>
            </select>
          </div>
          <div class="filter-group">
            <span class="filter-label">Tipo de Carga:</span>
            <select class="filter-select" id="filterCargoType">
              <option value="all" selected>Todos</option>
              <option value="container">Cont√™iner</option>
              <option value="bulk">Granel</option>
              <option value="liquid">L√≠quido</option>
              <option value="general">Carga Geral</option>
            </select>
          </div>
          <button class="btn btn-primary" id="btnApplyFilters">
            <i class="fas fa-filter"></i> Aplicar Filtros
          </button>
        </div>

        <div class="dashboard-stats">
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-card-title">TOTAL DE NAVIOS</div>
              <div class="stat-card-icon icon-primary">
                <i class="fas fa-ship"></i>
              </div>
            </div>
            <div class="stat-card-value">5</div>
            <div class="stat-card-desc">Ativos no sistema</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-card-title">TOTAL DE CARGAS</div>
              <div class="stat-card-icon icon-success">
                <i class="fas fa-boxes-stacked"></i>
              </div>
            </div>
            <div class="stat-card-value">28</div>
            <div class="stat-card-desc">Registradas no per√≠odo</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-card-title">PESO TOTAL</div>
              <div class="stat-card-icon icon-warning">
                <i class="fas fa-weight-hanging"></i>
              </div>
            </div>
            <div class="stat-card-value">1.250</div>
            <div class="stat-card-desc">Toneladas de carga</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-card-title">VALOR ESTIMADO</div>
              <div class="stat-card-icon icon-danger">
                <i class="fas fa-dollar-sign"></i>
              </div>
            </div>
            <div class="stat-card-value">R$ 4.2M</div>
            <div class="stat-card-desc">Em mercadorias</div>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Distribui√ß√£o de Cargas por Navio</h2>
              <div class="card-actions">
                <button class="btn-icon" id="btnRefreshChart">
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn-icon" id="btnDownloadChart">
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="cargoDistributionChart"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Navios por Capacidade</h2>
              <div class="card-actions">
                <button class="btn-icon" id="btnRefreshShips">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
            <div id="shipsList">
              <div class="ship-card">
                <div class="ship-icon">
                  <i class="fas fa-ship"></i>
                </div>
                <div class="ship-info">
                  <div class="ship-name">MSC Grandiosa</div>
                  <div class="ship-details">Cruzeiro ‚Ä¢ 181.541 toneladas</div>
                  <div class="progress-bar">
                    <div
                      class="progress-fill fill-success"
                      style="width: 85%"
                    ></div>
                  </div>
                </div>
                <div class="ship-cargo">
                  <div class="ship-cargo-count">8</div>
                  <div class="ship-cargo-label">cargas</div>
                </div>
              </div>
              <div class="ship-card">
                <div class="ship-icon">
                  <i class="fas fa-ship"></i>
                </div>
                <div class="ship-info">
                  <div class="ship-name">Ever Given</div>
                  <div class="ship-details">
                    Porta-Cont√™ineres ‚Ä¢ 220.940 toneladas
                  </div>
                  <div class="progress-bar">
                    <div
                      class="progress-fill fill-warning"
                      style="width: 65%"
                    ></div>
                  </div>
                </div>
                <div class="ship-cargo">
                  <div class="ship-cargo-count">12</div>
                  <div class="ship-cargo-label">cargas</div>
                </div>
              </div>
              <div class="ship-card">
                <div class="ship-icon">
                  <i class="fas fa-ship"></i>
                </div>
                <div class="ship-info">
                  <div class="ship-name">Maersk Sealand</div>
                  <div class="ship-details">
                    Porta-Cont√™ineres ‚Ä¢ 170.794 toneladas
                  </div>
                  <div class="progress-bar">
                    <div
                      class="progress-fill fill-primary"
                      style="width: 45%"
                    ></div>
                  </div>
                </div>
                <div class="ship-cargo">
                  <div class="ship-cargo-count">5</div>
                  <div class="ship-cargo-label">cargas</div>
                </div>
              </div>
              <div class="ship-card">
                <div class="ship-icon">
                  <i class="fas fa-ship"></i>
                </div>
                <div class="ship-info">
                  <div class="ship-name">Petrobras 36</div>
                  <div class="ship-details">Petroleiro ‚Ä¢ 125.000 toneladas</div>
                  <div class="progress-bar">
                    <div
                      class="progress-fill fill-danger"
                      style="width: 90%"
                    ></div>
                  </div>
                </div>
                <div class="ship-cargo">
                  <div class="ship-cargo-count">2</div>
                  <div class="ship-cargo-label">cargas</div>
                </div>
              </div>
              <div class="ship-card">
                <div class="ship-icon">
                  <i class="fas fa-ship"></i>
                </div>
                <div class="ship-info">
                  <div class="ship-name">Vale Brasil</div>
                  <div class="ship-details">Graneleiro ‚Ä¢ 198.980 toneladas</div>
                  <div class="progress-bar">
                    <div
                      class="progress-fill fill-success"
                      style="width: 30%"
                    ></div>
                  </div>
                </div>
                <div class="ship-cargo">
                  <div class="ship-cargo-count">1</div>
                  <div class="ship-cargo-label">cargas</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">√öltimas Cargas Registradas</h2>
            <div class="card-actions">
              <button class="btn-icon" id="btnRefreshTable">
                <i class="fas fa-sync-alt"></i>
              </button>
              <button class="btn-icon" id="btnExportTable">
                <i class="fas fa-file-export"></i>
              </button>
            </div>
          </div>
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Produto</th>
                  <th>Tipo</th>
                  <th>Quantidade</th>
                  <th>Peso (kg)</th>
                  <th>Origem</th>
                  <th>Destino</th>
                  <th>Navio</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Caf√©</td>
                  <td>Granel S√≥lido</td>
                  <td>500</td>
                  <td>25.000</td>
                  <td>Santos, Brasil</td>
                  <td>Roterd√£, Holanda</td>
                  <td>MSC Grandiosa</td>
                  <td><span class="badge badge-success">Embarcado</span></td>
                </tr>
                <tr>
                  <td>Eletr√¥nicos</td>
                  <td>Cont√™iner</td>
                  <td>50</td>
                  <td>12.500</td>
                  <td>Xangai, China</td>
                  <td>Santos, Brasil</td>
                  <td>Ever Given</td>
                  <td><span class="badge badge-primary">Em tr√¢nsito</span></td>
                </tr>
                <tr>
                  <td>Petr√≥leo</td>
                  <td>Granel L√≠quido</td>
                  <td>1</td>
                  <td>350.000</td>
                  <td>Maca√©, Brasil</td>
                  <td>Houston, EUA</td>
                  <td>Petrobras 36</td>
                  <td><span class="badge badge-warning">Aguardando</span></td>
                </tr>
                <tr>
                  <td>Autom√≥veis</td>
                  <td>Carga Geral</td>
                  <td>200</td>
                  <td>300.000</td>
                  <td>Yokohama, Jap√£o</td>
                  <td>Santos, Brasil</td>
                  <td>Maersk Sealand</td>
                  <td><span class="badge badge-primary">Em tr√¢nsito</span></td>
                </tr>
                <tr>
                  <td>Min√©rio de Ferro</td>
                  <td>Granel S√≥lido</td>
                  <td>1</td>
                  <td>400.000</td>
                  <td>Itabira, Brasil</td>
                  <td>Qingdao, China</td>
                  <td>Vale Brasil</td>
                  <td><span class="badge badge-success">Embarcado</span></td>
                </tr>
                <tr>
                  <td>Soja</td>
                  <td>Granel S√≥lido</td>
                  <td>1000</td>
                  <td>60.000</td>
                  <td>Sorriso, Brasil</td>
                  <td>Xangai, China</td>
                  <td>MSC Grandiosa</td>
                  <td><span class="badge badge-danger">Atrasado</span></td>
                </tr>
                <tr>
                  <td>Equipamentos M√©dicos</td>
                  <td>Cont√™iner</td>
                  <td>30</td>
                  <td>8.500</td>
                  <td>Berlim, Alemanha</td>
                  <td>Santos, Brasil</td>
                  <td>Ever Given</td>
                  <td><span class="badge badge-primary">Em tr√¢nsito</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      const loadingOverlay = document.getElementById("loadingOverlay");
      const btnApplyFilters = document.getElementById("btnApplyFilters");
      const btnRefreshChart = document.getElementById("btnRefreshChart");
      const btnDownloadChart = document.getElementById("btnDownloadChart");
      const btnRefreshShips = document.getElementById("btnRefreshShips");
      const btnRefreshTable = document.getElementById("btnRefreshTable");
      const btnExportTable = document.getElementById("btnExportTable");
      const statCardNavios = document.querySelector(
        ".stat-card:nth-child(1) .stat-card-value"
      );
      const statCardCargas = document.querySelector(
        ".stat-card:nth-child(2) .stat-card-value"
      );
      const statCardPeso = document.querySelector(
        ".stat-card:nth-child(3) .stat-card-value"
      );
      let cargoChart = null;

      // Inicializar dashboard ao carregar a p√°gina
      document.addEventListener("DOMContentLoaded", function () {
        // Mostrar loading
        loadingOverlay.style.display = "flex";

        // Carregar dados iniciais
        Promise.all([fetchNavios(), fetchCargas()])
          .then(([navios, cargas]) => {
            // Atualizar estat√≠sticas
            updateStats(navios, cargas);

            // Atualizar lista de navios
            updateShipsList(navios, cargas);

            // Atualizar tabela de cargas
            updateCargoTable(cargas);

            // Criar gr√°fico
            createCargoDistributionChart(navios, cargas);

            // Esconder loading
            loadingOverlay.style.display = "none";
          })
          .catch((error) => {
            console.error("Erro ao carregar dados:", error);
            alert("Erro ao carregar dados. Por favor, tente novamente.");
            loadingOverlay.style.display = "none";
          });

        // Adicionar eventos aos bot√µes
        btnApplyFilters.addEventListener("click", applyFilters);
        btnRefreshChart.addEventListener("click", refreshChart);
        btnDownloadChart.addEventListener("click", downloadChart);
        btnRefreshShips.addEventListener("click", refreshShipsList);
        btnRefreshTable.addEventListener("click", refreshCargoTable);
        btnExportTable.addEventListener("click", exportCargoTable);
      });

      // Buscar navios da API
      async function fetchNavios() {
        try {
          const response = await fetch("/navios/");
          if (!response.ok) {
            throw new Error("Falha ao buscar navios");
          }
          return await response.json();
        } catch (error) {
          console.error("Erro ao buscar navios:", error);
          throw error;
        }
      }

      // Buscar cargas da API
      async function fetchCargas() {
        try {
          const response = await fetch("/cargas/");
          if (!response.ok) {
            throw new Error("Falha ao buscar cargas");
          }
          return await response.json();
        } catch (error) {
          console.error("Erro ao buscar cargas:", error);
          throw error;
        }
      }

      // Atualizar estat√≠sticas
      function updateStats(navios, cargas) {
        // Total de navios
        statCardNavios.textContent = navios.length;

        // Total de cargas
        statCardCargas.textContent = cargas.length;

        // Peso total (em toneladas)
        const pesoTotal =
          cargas.reduce((total, carga) => total + carga.peso, 0) / 1000;
        statCardPeso.textContent = pesoTotal.toFixed(2);

        // Valor estimado (simulado com base no peso)
        const valorEstimado = pesoTotal * 3.5; // Valor fict√≠cio por tonelada
        document.querySelector(
          ".stat-card:nth-child(4) .stat-card-value"
        ).textContent = `R$ ${(valorEstimado / 1000).toFixed(1)}M`;
      }

      // Atualizar lista de navios
      function updateShipsList(navios, cargas) {
        const shipsList = document.getElementById("shipsList");
        shipsList.innerHTML = "";

        navios.forEach((navio) => {
          // Contar cargas para este navio
          const cargasDoNavio = cargas.filter(
            (carga) => carga.nomeNavio === navio.nome
          );
          const cargaCount = cargasDoNavio.length;

          // Calcular peso total das cargas deste navio
          const pesoTotal = cargasDoNavio.reduce(
            (total, carga) => total + carga.peso,
            0
          );

          // Calcular capacidade utilizada (simulado)
          const capacidade = navio.capacidade || 200000; // Valor padr√£o se n√£o tiver capacidade
          const capacidadeUsada = Math.min(
            100,
            Math.round((pesoTotal / capacidade) * 100)
          );

          // Determinar classe de cor com base na capacidade utilizada
          let fillClass = "fill-success";
          if (capacidadeUsada > 70) {
            fillClass = "fill-danger";
          } else if (capacidadeUsada > 40) {
            fillClass = "fill-warning";
          }

          // Criar card do navio
          const shipCard = document.createElement("div");
          shipCard.className = "ship-card";
          shipCard.innerHTML = `
      <div class="ship-icon">
        <i class="fas fa-ship"></i>
      </div>
      <div class="ship-info">
        <div class="ship-name">${navio.nome}</div>
        <div class="ship-details">${
          navio.tipo || "Cargueiro"
        } ‚Ä¢ ${capacidade.toLocaleString()} toneladas</div>
        <div class="progress-bar">
          <div class="progress-fill ${fillClass}" style="width: ${capacidadeUsada}%;"></div>
        </div>
      </div>
      <div class="ship-cargo">
        <div class="ship-cargo-count">${cargaCount}</div>
        <div class="ship-cargo-label">cargas</div>
      </div>
    `;

          shipsList.appendChild(shipCard);
        });

        // Se n√£o houver navios, mostrar mensagem
        if (navios.length === 0) {
          shipsList.innerHTML = `
      <div style="text-align: center; padding: 20px; color: var(--gray-color);">
        <i class="fas fa-ship" style="font-size: 48px; margin-bottom: 15px; color: #ddd;"></i>
        <h3>Nenhum navio cadastrado</h3>
        <p>Cadastre navios para visualizar informa√ß√µes aqui.</p>
        <a href="CadastroNavio.html" class="btn btn-primary" style="margin-top: 10px;">
          <i class="fas fa-plus"></i> Cadastrar Navio
        </a>
      </div>
    `;
        }
      }

      // Atualizar tabela de cargas
      function updateCargoTable(cargas) {
        const tbody = document.querySelector(".data-table tbody");
        tbody.innerHTML = "";

        cargas.forEach((carga) => {
          // Determinar status (simulado)
          const statusOptions = [
            "Embarcado",
            "Em tr√¢nsito",
            "Aguardando",
            "Atrasado",
          ];
          const statusClasses = [
            "badge-success",
            "badge-primary",
            "badge-warning",
            "badge-danger",
          ];
          const statusIndex = Math.floor(Math.random() * statusOptions.length);

          const row = document.createElement("tr");
          row.innerHTML = `
      <td>${carga.produto}</td>
      <td>${carga.tipodeCarga}</td>
      <td>${carga.quantidade}</td>
      <td>${carga.peso.toLocaleString()}</td>
      <td>${carga.origem}</td>
      <td>${carga.destino}</td>
      <td>${carga.nomeNavio}</td>
      <td><span class="badge ${statusClasses[statusIndex]}">${
            statusOptions[statusIndex]
          }</span></td>
    `;

          tbody.appendChild(row);
        });

        // Se n√£o houver cargas, mostrar mensagem
        if (cargas.length === 0) {
          const row = document.createElement("tr");
          row.innerHTML = `
      <td colspan="8" style="text-align: center; padding: 20px;">
        Nenhuma carga cadastrada. <a href="CadastroCarga.html">Cadastrar carga</a>
      </td>
    `;
          tbody.appendChild(row);
        }
      }

      // Criar gr√°fico de distribui√ß√£o de cargas por navio
      function createCargoDistributionChart(navios, cargas) {
        const ctx = document
          .getElementById("cargoDistributionChart")
          .getContext("2d");

        // Processar dados para o gr√°fico
        const shipNames = navios.map((navio) => navio.nome);
        const cargoCounts = shipNames.map((nome) => {
          return cargas.filter((carga) => carga.nomeNavio === nome).length;
        });

        const cargoWeights = shipNames.map((nome) => {
          return (
            cargas
              .filter((carga) => carga.nomeNavio === nome)
              .reduce((total, carga) => total + carga.peso, 0) / 1000
          ); // Converter para toneladas
        });

        // Destruir gr√°fico existente se houver
        if (cargoChart) {
          cargoChart.destroy();
        }

        // Criar gr√°fico
        cargoChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: shipNames,
            datasets: [
              {
                label: "N√∫mero de Cargas",
                data: cargoCounts,
                backgroundColor: "rgba(0, 119, 204, 0.7)",
                borderColor: "rgba(0, 119, 204, 1)",
                borderWidth: 1,
                yAxisID: "y",
              },
              {
                label: "Peso Total (ton)",
                data: cargoWeights,
                backgroundColor: "rgba(46, 204, 113, 0.7)",
                borderColor: "rgba(46, 204, 113, 1)",
                borderWidth: 1,
                type: "line",
                yAxisID: "y1",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
              },
              tooltip: {
                mode: "index",
                intersect: false,
              },
            },
            scales: {
              y: {
                type: "linear",
                display: true,
                position: "left",
                title: {
                  display: true,
                  text: "N√∫mero de Cargas",
                },
                beginAtZero: true,
              },
              y1: {
                type: "linear",
                display: true,
                position: "right",
                grid: {
                  drawOnChartArea: false,
                },
                title: {
                  display: true,
                  text: "Peso Total (ton)",
                },
                beginAtZero: true,
              },
            },
          },
        });

        return cargoChart;
      }

      // Aplicar filtros
      function applyFilters() {
        // Mostrar loading
        loadingOverlay.style.display = "flex";

        // Buscar dados atualizados
        Promise.all([fetchNavios(), fetchCargas()])
          .then(([navios, cargas]) => {
            // Aplicar filtros
            const period = document.getElementById("filterPeriod").value;
            const cargoType = document.getElementById("filterCargoType").value;

            // Filtrar cargas por tipo (se selecionado)
            let filteredCargas = cargas;
            if (cargoType !== "all") {
              const tipoMap = {
                container: "Cont√™iner",
                bulk: "Granel",
                liquid: "L√≠quido",
                general: "Carga Geral",
              };

              filteredCargas = cargas.filter((carga) =>
                carga.tipodeCarga.includes(tipoMap[cargoType] || "")
              );
            }

            // Atualizar estat√≠sticas
            updateStats(navios, filteredCargas);

            // Atualizar lista de navios
            updateShipsList(navios, filteredCargas);

            // Atualizar tabela de cargas
            updateCargoTable(filteredCargas);

            // Atualizar gr√°fico
            createCargoDistributionChart(navios, filteredCargas);

            // Esconder loading
            loadingOverlay.style.display = "none";
          })
          .catch((error) => {
            console.error("Erro ao aplicar filtros:", error);
            alert("Erro ao aplicar filtros. Por favor, tente novamente.");
            loadingOverlay.style.display = "none";
          });
      }

      // Atualizar gr√°fico
      function refreshChart() {
        // Mostrar loading
        loadingOverlay.style.display = "flex";

        // Buscar dados atualizados
        Promise.all([fetchNavios(), fetchCargas()])
          .then(([navios, cargas]) => {
            // Atualizar gr√°fico
            createCargoDistributionChart(navios, cargas);

            // Esconder loading
            loadingOverlay.style.display = "none";
          })
          .catch((error) => {
            console.error("Erro ao atualizar gr√°fico:", error);
            alert("Erro ao atualizar gr√°fico. Por favor, tente novamente.");
            loadingOverlay.style.display = "none";
          });
      }

      // Download do gr√°fico
      function downloadChart() {
        const canvas = document.getElementById("cargoDistributionChart");
        const image = canvas.toDataURL("image/png");

        const link = document.createElement("a");
        link.href = image;
        link.download = "distribuicao-cargas.png";
        link.click();
      }

      // Atualizar lista de navios
      function refreshShipsList() {
        // Mostrar loading
        loadingOverlay.style.display = "flex";

        // Buscar dados atualizados
        Promise.all([fetchNavios(), fetchCargas()])
          .then(([navios, cargas]) => {
            // Atualizar lista de navios
            updateShipsList(navios, cargas);

            // Esconder loading
            loadingOverlay.style.display = "none";
          })
          .catch((error) => {
            console.error("Erro ao atualizar lista de navios:", error);
            alert(
              "Erro ao atualizar lista de navios. Por favor, tente novamente."
            );
            loadingOverlay.style.display = "none";
          });
      }

      // Atualizar tabela de cargas
      function refreshCargoTable() {
        // Mostrar loading
        loadingOverlay.style.display = "flex";

        // Buscar dados atualizados
        fetchCargas()
          .then((cargas) => {
            // Atualizar tabela de cargas
            updateCargoTable(cargas);

            // Esconder loading
            loadingOverlay.style.display = "none";
          })
          .catch((error) => {
            console.error("Erro ao atualizar tabela de cargas:", error);
            alert(
              "Erro ao atualizar tabela de cargas. Por favor, tente novamente."
            );
            loadingOverlay.style.display = "none";
          });
      }

      // Exportar tabela de cargas
      function exportCargoTable() {
        // Mostrar loading
        loadingOverlay.style.display = "flex";

        // Buscar dados atualizados
        fetchCargas()
          .then((cargas) => {
            // Criar CSV
            let csv = "Produto,Tipo,Quantidade,Peso,Origem,Destino,Navio\n";

            cargas.forEach((carga) => {
              csv += `"${carga.produto}","${carga.tipodeCarga}",${carga.quantidade},${carga.peso},"${carga.origem}","${carga.destino}","${carga.nomeNavio}"\n`;
            });

            // Criar blob e download
            const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.setAttribute("download", "cargas.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Esconder loading
            loadingOverlay.style.display = "none";
          })
          .catch((error) => {
            console.error("Erro ao exportar tabela:", error);
            alert("Erro ao exportar tabela. Por favor, tente novamente.");
            loadingOverlay.style.display = "none";
          });
      }
    </script>
  </body>
</html>
